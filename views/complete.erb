<div class="first_run_form success">
  <h3>Engines setup</h3>

  <div id="clompleting_first_run_message">
    <h4>Preparing system</h4>
    <p>Please wait...</p>
  </div>

  <div id="starting_system_message" style="display: none;">
    <h4>Building system</h4>
    <p>The Engines system is building. This normally takes a few minutes.</p>
    <p>Once the build is complete, the Engines management interface will be available at <a href="<%= @mgmt_url %>" target="<%= @mgmt_url %>"><%= @mgmt_url %></a>.</p>
  </div>
</div>

<script>

var main = function() {
  postCloseFirstRun();
};

var ajaxCall = function (type, URL, successFunc, errorFunc) {
  var ajaxRequest = new XMLHttpRequest();
  ajaxRequest.open(type, URL, true);
  ajaxRequest.onreadystatechange = function () {
    if (ajaxRequest.readyState == 4) {
      // if (ajaxRequest.status == 200) {
        successFunc(ajaxRequest);
      // } else {
      //   errorFunc(ajaxRequest);
      // }
    };
  };
  ajaxRequest.send();
};

var postCloseFirstRun = function() {
  ajaxCall('POST',
    '<%= @api_url %>/v0/unauthenticated/bootstrap/first_run/complete',
    function() {
    setTimeout(function() {
      document.getElementById("clompleting_first_run_message").style.display = 'none';
      document.getElementById("starting_system_message").style.display = 'block';
    }, 2000);
  }, function() {
  setTimeout(function() {
    alert('Error: failed to complete setup.');
  }, 2000) });
};

main();

</script>
